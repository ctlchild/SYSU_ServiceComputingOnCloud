# 让你的计算机也能提供云桌面服务

### 个人信息

数据科学与计算机学院 17343012 陈泰霖

### 实验目的

- 初步了解虚拟化技术，理解云计算的相关概念
- 理解系统工程师面临的困境
- 理解自动化安装、管理（DevOps）在云应用中的重要性

### 实验环境与要求

- 用户通过互联网，使用微软远程桌面，远程访问你在PC机上创建的虚拟机
- 虚拟机操作系统 Centos，Ubuntu，或你喜欢的 Linux 发行版，能使用 NAT 访问外网。

### 实验内容

#### 1.创建并配置Linux虚拟机

​	在VMware上创建新的虚拟机，选择自定义，选择安装程序光盘映像文件，选择安装下载好的iso文件。我选择的是`CentOS-7-x86_64-DVD-1810.iso`，可以方便安装桌面版操作比较方便。

![](F:\常用\大三上\服务计算\hw1\捕获12.PNG)

之后是设置处理器，我选择了2个处理器，每个处理器内核数量2。

内存分配了4096MB也就是4GB。

网络连接选择了使用网络地址转换。

SCSI控制器选择了 LSI Logic。

虚拟磁盘类型选择了SCSI。

选择磁盘时选择创建新虚拟磁盘，磁盘大小设置为30GB，勾选立即分配所有磁盘空间，并选择将虚拟磁盘存储为单个文件。（用VMware创建虚拟磁盘时自动选择了vmdk格式，如果是用VirtualBox安装也可以用这个格式，好处是之后安装操作系统在选择磁盘时，磁盘已经自动格式化完成，可以直接使用）

然后点击自定义硬件。点击左下的添加按钮，选择网络适配器，得到网络适配器2，原来的网络适配器是NAT模式不做修改，而网络适配器2选择仅主机模式。

![](F:\常用\大三上\服务计算\hw1\捕获14.PNG)

之后就可以开启虚拟机进行操作系统的安装了。

在安装信息摘要界面，需要配置软件选择，安装位置，和网络与主机名。

软件选择我选择了带GUI的服务器，勾选了开发工具。

![](F:\常用\大三上\服务计算\hw1\捕获3.PNG)

安装位置选择之前创建的30GB的虚拟磁盘并自动配置分区。

网络和主机名部分，可以看到有以太网（ens33）和以太网（ens34）。

以太网（ens33）是与NAT模式的网络适配器相关的，点击打开，不做修改。

![](F:\常用\大三上\服务计算\hw1\捕获.PNG)

而以太网（ens34）是与仅主机模式的网络适配器相关的，需要更改。点击配置，选择IPv4设置，方法设为手动，添加地址，比如地址是192.168.150.100，子网掩码是255.255.255.0，网关为192.168.150.1。DNS服务器与以太网（ens33）的一致。

![](F:\常用\大三上\服务计算\hw1\捕获2.PNG)

点击开始安装后配置ROOT密码和创建用户。

![](F:\常用\大三上\服务计算\hw1\捕获5.PNG)

最后接受许可证。

![](F:\常用\大三上\服务计算\hw1\捕获6.PNG)

这样操作系统就安装完成了。

#### 2.设置虚拟机静态ip，配置xshell使得主机可以用ssh访问虚拟机

进入虚拟机桌面后，尝试ping外网，主机和内网，发现外网可以ping通，主机可以ping通，而内网不可以ping通。在终端输入`ip addr`时发现ens34没有ip地址。

设置ens34的网络配置，在终端输入`sudo gedit /etc/sysconfig/network-scripts/ifcfg-ens34`，如果没有加`sudo`只会以只读模式打开，然后进行如下编辑。

```
BOOTPROTO=static 
ONBOOT=yes
```

![](F:\常用\大三上\服务计算\hw1\捕获8.PNG)

保存后在终端输入`service network restart  `重启网络服务。

再输入`ip addr`时就可以发现ens34中有刚设置的ip地址。

![](F:\常用\大三上\服务计算\hw1\捕获9.PNG)

关闭虚拟机。在VMware左上点击编辑，点击虚拟网络编辑器。更改设置，把VMnet1（仅主机模式）的使用本地DHCP服务将IP地址分配给虚拟机的勾选去掉，更改子网IP与之前设置的ip地址相对应。

![](F:\常用\大三上\服务计算\hw1\捕获16.PNG)

之后启动虚拟机就可以发现外网，内网，主机都可以ping通了。

接下来是用xshell连接虚拟机部分

在虚拟机终端输入`firewall-cmd --query-port=22/tcp`查看22号端口是否开启

如果没有开启则输入`firewall-cmd --add-port=22/tcp --permanent `开启端口

并输入`firewall-cmd --reload`重新载入配置

之后再次查看端口，输入`firewall-cmd --query-port=22/tcp`，此时会打印`yes`表示端口开启。

![](F:\常用\大三上\服务计算\hw1\捕获10.PNG)

在主机上用xshell新建会话

![](F:\常用\大三上\服务计算\hw1\捕获17.PNG)

点击连接，输入用户名和密码后就可以用ssh访问虚拟机了。

![](F:\常用\大三上\服务计算\hw1\捕获18.PNG)

